## 1. 数据处理

* 用procd.py处理原数据（如GSE189792_Processed_data.xlsx），保留指定行，过滤全零行
* 手动清除带有‘1’的列名，无用（属于原实验修正/处理的结果，为非原始测量的数据）cleaned_data.xlsx

## 2. 数据二次处理取组间平均值进行对比

* cal_mean.py 计算组间平均值 并得到五个CSV (clea.csv down up specific_gf/scfa),可以通过命令行参数 -f 和 -p 来指定,目前默认log2fc为0.5，p小于等于0.05才会保留。这样输出文件就可以直接进行映射了，序列号5

## ~~3.消除重复基因~~

* ~~non_duplicate_genes.py 消除重复基因, 仍然还是需要  这一步可以先省略，后续处理再用。~~

## 4. 基因可视化

~~~~首先用another.py 处理clean_data.xlsx，得到ano.csv 后用non_dupli去除重复基因，得到non_another.CSV,最后基因可视化火山图
gene_analysis.py （要用具有连续性的P值，而非调整后的P值，否则欠缺连续性）~~

~~another.py 继承calc_means.py只是缺少p值筛选那一步（保留P值为0.05的行）。~~~~

## 5. 基因映射通路

直接用clear.csv 进行calc_means.py，输出五个文件，包含了上调下调的基因，刺是没有取差异性基因，且未去重，得到cle4.csv（已经是P值保留后的结果。）

* ~~先提取差异基因 从cle4.csv中提取reject_null为TRUE的行（diff_genes.py），得到diff_genes.csv以及一系列其他文件~~
* ~~然后继续non_duplicate_genes.py处理，得到nondu.csv~~
* ~~基因名变换，网址：https://biodbnet-abcc.ncifcrf.gov/db/db2db.php kegg gene id///或者不变化，直接映射~~
* (直接映射)进行通路富集分析 enrich.py代码中的库 自己指定-i 输入文件  -o 输出文件  -k 数据库  -l 查看多少库，库名称 -p 指定p值 -n 指定前几行?

## 6. 取差异性基因

* 从cle4.csv中提取reject_null为TRUE的行（diff_genes.py），得到diff_genes.csv以及一系列其他文件

## 7. 跟sage数据差异性基因取交集

* 两个数据集中的基因名取交集，后去重，得到non_common.csv, 暂存results中的jiaoji文件夹。后续映射通路和互作。

## 8. 剩余单组数据处理

- 两个数据集的差异性基因可自行进行通路映射和互作。 逻辑同7

## 9. 关键词搜索

* search_test.py 关键词搜索，utils是必要的文件夹
  结果呈现多个，具体见代码搜索词。

## 10. 关键词提取

* 逻辑：多层次关键词分类：
  核心分子：SCFA、丁酸盐、HDAC、FFAR(GPR41/GPR43)、G蛋白
  免疫细胞：巨噬细胞(M1/M2)、T细胞(Th1/Th2/Th17/Treg)
  信号通路：MAPK、NF-κB、Stat通路、组蛋白修饰
  肠-肺轴：微生物组、肠道菌群、代谢物
  针灸机制：神经-内分泌-免疫网络、迷走神经、交感/副交感

# 关于通路设想

猜想1: SCFAs-HDAC-M2极化-针刺对哮喘的调节
科学基础:
SCFAs（特别是丁酸盐）是公认的组蛋白去乙酰化酶(HDAC)抑制剂
HDAC抑制可以促进巨噬细胞向M2型（抗炎）极化
M2型巨噬细胞在哮喘炎症控制中发挥重要作用
针灸已被证明可以调节免疫细胞极化
研究价值:
揭示针灸通过SCFAs-HDAC-M2轴调节哮喘的分子机制
连接传统针灸与现代表观遗传学研究
为针灸与丁酸钠联合治疗提供理论基础
猜想2: SCFA-T细胞-针刺-哮喘s
科学基础:
SCFAs已被证明可以影响T细胞分化和功能
SCFAs促进Treg细胞产生和抑制Th2、Th17反应
哮喘的核心病理与Th1/Th2失衡和Treg功能缺陷相关
针灸可以调节T细胞亚群平衡和功能
研究价值:
阐明针灸通过调节肠道SCFAs进而影响肺部T细胞反应的机制
探索针灸-SCFAs-T细胞轴在哮喘发病和治疗中的作用
为发现新的免疫调节靶点提供线索
猜想3: SCFAs-针刺-肺部FFAR表达
科学基础:
FFARs (特别是FFAR2/GPR43和FFAR3/GPR41)是SCFAs的关键受体
肺部确实表达这些受体，尤其是上皮细胞和免疫细胞
SCFAs通过FFAR信号影响细胞功能和炎症反应
G蛋白偶联受体信号通路是针灸调节的已知靶点
研究价值:
探究针灸是否/如何调节肺部FFAR表达
揭示SCFAs-FFAR信号在针灸治疗哮喘中的作用
建立"肠-肺轴"与针灸疗效之间的分子联系

# 关于cal_mean.py中的~~P值计算~~有变化

* ~~鉴于原数据是无菌鼠与野生鼠的处理，因此得到的数据中一组包含多个零值（一组存在表达一组没有表达，传统t-test会导致损失特异性基因无法呈现在结果中，可能忽略重要作用基因）~~
* ~~首先，并非means±std进行计算，而是两组中各个样本进行计算（3×2组）
  对于该情况的代码处理为以下：
  1.若两组都有表达的基因（至少两个样本有表达），使用Welch's t-test计算P值，调用SCIPY库的ttest_ind函数。
  2.组特异性表达的基因，其P值分配基于：
  1）表达强度：平均表达值越高，p值越小（更显著）
  2) 表达一致性：变异系数（CV）越小，p值越小
  3.不满足上述情况时，人工赋予P值为1，表示完全不显著。~~
* ~~P值校正
  为控制多重检验问题，脚本使用Benjamini-Hochberg方法（也称为FDR方法）进行p值校正，控制假阳性率。~~
* ~~结果解释
  pvalue 列包含原始p值
  padj 列包含经过多重检验校正的p值
  reject_null 列指示是否拒绝原假设（基于校正后的p值）
  gene_type 列标识基因的分类类型~~
* 首先一组有表达，一组无表达的处理：表达水平越高（gf_mean/np.max(gf_vals)越大）；变异越小（1-gf_cv越大）；P值就越小；最终P值被限制在[1e-10, 0.05]范围内
* 两组皆表达的情况：首先计算相对差异（relative_diff）和平均变异系数（avg_cv）；如果相对差异和变异都小于10%，认为两组没有显著差异，p_val = 1.0；否则使用Welch's t-test计算p值（不假设两组方差相等）
* 最后，对所有P值进行多重检验校正
* 可避免统计检验中出现零方差的问题。显著性更可靠。————对特异性表达和肺特异性表达采用不同计算方法，多重检验校正控制假阳性率

# 关于基因名重复的问题

   为避免后续可视化时，基因名重复，使用non_duplicate_genes.py处理，输出文件为nondu.csv.基因数量从30000+减少到10000+，文件可用于热图和火山图可视化（gene_analysis.py处理）

# 关于基因映射通路

* 使用gseapy进行富集分析 enrich.py代码中的库 自己指定-i 输入文件  -o 输出文件  -k 数据库  -l 查看多少库，库名称 -p 指定p值 -n 指定前几行?
